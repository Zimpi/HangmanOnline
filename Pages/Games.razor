@page "/games"
@inject GameManager GameManager
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager
@implements IDisposable

<PageTitle>Hangman Online - Sessions</PageTitle>


<div style="min-height: 90vh">
    
    <MudText Typo="Typo.h5">Übersicht öffentlicher Sessions</MudText>

    <MudText Typo="Typo.caption">@GameManager.CurrentSessions.Count Sessions Aktiv</MudText>

    <div style="position: absolute; bottom: 30px; right: 30px">
        <MudFab Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="NewSession" />
    </div>

    <MudStack Spacing="3">
        @foreach (var session in GameManager.CurrentSessions)
        {
            <MudCard>
                <MudCardContent>
                    <MudText Typo="Typo.h6">Hangman Session</MudText>
                    <MudText Typo="Typo.subtitle1">Host: @session.Host.PlayerName</MudText>
                    <MudText Typo="Typo.subtitle2">@session.PlayersCount Spieler sind in dieser Session</MudText>
                </MudCardContent>
                <MudCardActions>
                    <MudButton OnClick="() => JoinPublicSession(session)" Variant="Variant.Text" Color="Color.Primary">Session Beitreten</MudButton>
                </MudCardActions>
            </MudCard>
        }
    </MudStack>

</div>






@code {

    protected override void OnInitialized()
    {
        base.OnInitialized();

        GameManager.SessionCreated += GameManager_SessionCreated;
        GameManager.SessionRemoved += GameManager_SessionRemoved;
    }

    private void GameManager_SessionRemoved(Guid obj)
    {
        InvokeAsync(StateHasChanged);
    }

    private void GameManager_SessionCreated(Session obj)
    {
        InvokeAsync(StateHasChanged);
        Snackbar.Add($"Session {obj.SessionCode} wurde erstellt", Severity.Success);
    }

    public void Dispose()
    {
        GameManager.SessionCreated -= GameManager_SessionCreated;
        GameManager.SessionRemoved -= GameManager_SessionRemoved;
    }

    private void AddSession()
    {
        GameManager.CreateSession("Parkplatz", "Jan");
    }

    private void JoinPublicSession(Session session)
    {
        NavigationManager.NavigateTo($"/session/{session.SessionGuid}");
    }

    private void NewSession()
    {
        
    }

}
